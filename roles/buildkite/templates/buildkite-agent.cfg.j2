# Buildkite Agent Configuration
# Managed by Ansible - do not edit manually

# Agent token from Buildkite
token="{{ vault_buildkite_agent_token }}"

# Agent name (includes hostname and agent number)
name="{{ ansible_facts['hostname'] }}-%spawn"

# Agent priority (higher = picked first)
priority={{ buildkite_agent_priority }}

# Tags for targeting builds
tags="{{ buildkite_agent_tags | join(',') }}"

# Build paths
build-path="{{ buildkite_builds_path }}"
hooks-path="{{ buildkite_hooks_path }}"
plugins-path="{{ buildkite_plugins_path }}"

# Git settings
git-clean-flags="-ffdq"
git-clone-flags="-v"
git-clone-mirror-flags="-v"

# Job settings
cancel-grace-period=30
cancel-signal=SIGTERM
disconnect-after-idle-timeout=0

# Disable PTY allocation (prevents issues with non-interactive builds)
no-pty=true

# Acquire jobs with File locks to prevent race conditions
acquire-job=file-lock

# Shell (use bash for consistency)
shell="/bin/bash -e -c"

# Health check (port offset by spawn number)
health-check-addr="127.0.0.1:808%spawn"

# Logging
debug=false

# Timestamps in logs
timestamp-lines=true
