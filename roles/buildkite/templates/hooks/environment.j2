#!/bin/bash
# Buildkite environment hook
# Managed by Ansible - do not edit manually

set -euo pipefail

# Ensure Homebrew is in PATH
export PATH="{{ homebrew_prefix }}/bin:{{ homebrew_prefix }}/sbin:$PATH"

# Source build secrets if available
SECRETS_FILE="{{ homebrew_prefix }}/etc/buildkite-agent/secrets/build-secrets.env"
if [[ -f "$SECRETS_FILE" ]]; then
  # shellcheck source=/dev/null
  source "$SECRETS_FILE"
fi

# Docker configuration
export DOCKER_HOST="unix://$HOME/.docker/run/docker.sock"
export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1

# Git configuration
export GIT_TERMINAL_PROMPT=0

# Disable analytics/telemetry for common tools
export HOMEBREW_NO_ANALYTICS=1
export DO_NOT_TRACK=1

# Increase file descriptor limit for large builds
ulimit -n 65536 2>/dev/null || true
