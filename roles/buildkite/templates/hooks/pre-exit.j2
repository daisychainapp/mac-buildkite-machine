#!/bin/bash
# Buildkite pre-exit hook - cleanup after each job
# Managed by Ansible - do not edit manually

# Don't fail on cleanup errors
set +e

# Clean up any dangling Docker resources from this build
if command -v docker &> /dev/null; then
    # Remove containers that exited from this build
    docker container prune -f --filter "until=1h" 2>/dev/null || true

    # Remove dangling images (untagged)
    docker image prune -f 2>/dev/null || true
fi

# Clean up any temporary files older than 1 day
find /tmp -name "buildkite-*" -mtime +1 -delete 2>/dev/null || true

exit 0
